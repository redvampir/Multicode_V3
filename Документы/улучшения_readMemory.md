# Улучшения инструмента `/api/readMemory`

## Функциональные доработки
- Поддержать необязательный `encoding`-флаг запроса, позволяя клиенту явно выбирать `utf8` или `base64`; при несоответствии содержимого возвращать 415.
- Добавить ограничение на максимальное значение `bytes` (например, 8–16 МБ) и возвращать 413, чтобы защититься от случайного чтения огромных файлов и давления на память.
- В ответ включать поле `mime` с приблизительным типом содержимого (по расширению или `tree_magic_mini`), чтобы клиент знал, как отображать результат.
- Для бинарных файлов возвращать фрагменты в base64 и добавлять `content_preview` (первые 64 байта в hex) для быстрой диагностики.

## Безопасность и стабильность
- Фильтровать пути: запрещать `..` и символические ссылки вне доверенной директории, чтобы избежать обхода директорий и чтения системных файлов.
- Добавить таймаут чтения (через `tokio::time::timeout`) и отмену запроса при его превышении; логировать превышения.
- Возвращать чёткие коды ошибок: 400 — неверный `range`, 404 — нет файла, 416 — начало диапазона >= размера, 500 — системные ошибки ввода/вывода.

## Наблюдаемость
- Логировать обращения к эндпоинту: путь файла, диапазон, тип кодировки, длительность чтения; аномалии (усечения, таймауты) помечать тегами в метриках.
- Экспортировать счётчики: количество запросов, распределение размеров `bytes`, доля ответов с `truncated=true`.

## Тестирование
- Протестировать работу с бинарными файлами: убедиться, что base64 выдаётся корректно, и контент неповреждён после обратной декодировки.
- Добавить property-based тесты для генерации случайных диапазонов и проверки, что `chunk_end <= size` и `content` соответствует исходному файлу.
- Проверить устойчивость к ошибкам: несуществующий файл, некорректный путь, пустой файл, таймаут чтения, превышение лимита `bytes`.
