# Multicode V3

## Обзор
Multicode V3 — редактор исходного кода, который объединяет текстовое и визуальное представления программ. Пользователь может свободно переключаться между режимами и работать с дополнительными метаданными без изменения логики кода.

## Архитектура
- **Backend (Rust, Tauri):** парсинг файлов через tree-sitter, хранение и обработка метаданных, управление плагинами.
- **Frontend (Vite, JavaScript):** интерфейс с Monaco‑редактором и canvas‑основанным редактором блоков.
- **Связь компонентов:** локальный WebSocket‑сервер синхронизирует состояния между частями приложения.

## Ключевые возможности
- Переключение между текстовым и визуальным режимами.
- Сохранение метаданных в комментариях к исходному коду.
- Поддержка плагинов для расширения набора блоков.
- Работа с несколькими языками программирования.

## Структура метакомментариев
Служебная информация сохраняется в комментариях `@VISUAL_META` в формате JSON. Общая структура:
```json
{
  "id": "уникальный идентификатор блока",
  "x": координатаX,
  "y": координатаY,
  "note": "произвольный текст"
}
```
Комментарий не влияет на выполнение программы и может быть удалён при экспорте.

## Инструкции по запуску и сборке
1. Установите Rust, Node.js и [Tauri CLI](https://tauri.app).
2. Установите зависимости и выполните тесты:
   ```
   cd frontend && npm install && npm test
   cd ../backend && cargo test
   ```
3. Запуск режима разработки:
   ```
   cd frontend
   npm run tauri dev
   ```
4. Сборка десктопного приложения:
   ```
   cd frontend
   npm run tauri build
   ```
   Скомпилированные бинарные файлы появятся в `frontend/src-tauri/target/release`.

## Использование CLI
Бэкенд предоставляет интерфейс командной строки с несколькими подкомандами:

- `parse` — разобрать файл и вывести блоки в формате JSON.
  ```
  cargo run -- parse path/to/file.rs --lang rust
  ```
- `export` — сохранить файл, при необходимости удалив метаданные.
  ```
  cargo run -- export input.rs output.rs --strip-meta
  ```
- `metadata` — вывести метаданные, сохранённые в файле.
  ```
  cargo run -- metadata path/to/file.rs
  ```

## Добавление модулей
Плагины позволяют добавлять новые блоки и функциональность.
- **Backend:** реализуйте трейт `Plugin`, возвращающий `BlockDescriptor`.
- **Frontend:** подключите модуль через `register({ Block, registerBlock })` и функцию `loadBlockPlugins`.
- Пример реализации находится в `examples/plugins`.

## Словарь
- **Блок:** визуальное представление участка кода.
- **Метакомментарий:** комментарий `@VISUAL_META` с координатами и прочими данными.
- **Плагин:** набор расширений для добавления новых блоков.

## Структура репозитория
- `backend` — серверная часть на Rust.
- `frontend` — интерфейс и клиентская логика.
- `plugins` — встроенные плагины и механизм их загрузки.
- `examples` — примеры плагинов и использования.
- `logs` — временные файлы и журналы.

## Лицензия
Проект распространяется по лицензии MIT. Полный текст приведён в файле [LICENSE](LICENSE).
