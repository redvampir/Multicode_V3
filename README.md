# Multicode V3

Multicode V3 — редактор исходного кода с двумя режимами: текстовым и визуальным. В текстовом режиме используется Monaco, а визуальный представляет программы в виде блоков, которые можно перемещать и связывать.

Пример переключения между режимами можно найти в документации проекта (изображения не включены в репозиторий).

## Назначение
- Быстрое переключение между текстовым и визуальным представлением кода.
- Сохранение дополнительных метаданных (позиции, переводы, заметки) вместе с исходниками.

## Метаданные в комментариях
Редактор сохраняет служебную информацию в исходном файле через специальные комментарии `@VISUAL_META` в формате JSON. Они не мешают исполнению программы и могут быть безопасно удалены.

### Примеры
```python
# @VISUAL_META {"id":"1","x":0,"y":0}
print("hello")
```

```javascript
// @VISUAL_META {"id":"1","x":0,"y":0}
console.log("hi")
```

```rust
// @VISUAL_META {"id":"1","x":0,"y":0}
fn main() {}
```

```html
<!-- @VISUAL_META {"id":"1","x":0,"y":0} -->
<div>Block</div>
```

```css
/* @VISUAL_META {"id":"1","x":0,"y":0} */
.selector { color: red; }
```

## Архитектура
- **Backend (Rust, Tauri)** — парсит файлы через tree-sitter, хранит метаданные и управляет плагинами.
- **Frontend (Vite, JS)** — отображает Monaco‑редактор и canvas‑основанный редактор блоков.
- Для синхронизации используется локальный WebSocket‑сервер.

## Поддерживаемые языки
- Rust
- Python
- JavaScript
- TypeScript
- HTML
- CSS
- C++
- C#
- Go
- Java
- Swift
- Kotlin
- PHP
- Ruby
- Dart

## Запуск и сборка
1. Установите Rust, Node.js и [Tauri CLI](https://tauri.app). Убедитесь, что команда `cargo tauri` доступна.
2. Установите зависимости и выполните тесты:
   ```
   cd frontend && npm install && npm test
   cd ../backend && cargo test
   ```
3. Запуск в режиме разработки:
   ```
   cd frontend
   npm run tauri dev
   ```
4. Сборка десктопного приложения:
   ```
   cd frontend
   npm run tauri build
   ```
   Полученные бинарные файлы будут находиться в `frontend/src-tauri/target/release`.

## Плагины
Плагины расширяют редактор новыми блоками.

- Backend‑часть реализует трейт `Plugin` и возвращает `BlockDescriptor` для каждого блока.
- Frontend‑часть предоставляет модуль `register({ Block, registerBlock })` и подключается через `loadBlockPlugins`.
- Пример плагина находится в [`examples/plugins`](examples/plugins).

## Как внести вклад
1. Форкните репозиторий и создайте ветку.
2. Добавьте код или новый плагин, следуя стилю проекта.
3. Запустите тесты и отправьте Pull Request.

## FAQ

**Почему метаданные хранятся в комментариях?**

Так их можно легко связать с исходным кодом и при необходимости удалить при экспорте.

**Где найти описание архитектуры?**

Смотрите раздел [Архитектура](#архитектура) и директории с исходным кодом: [`backend`](backend) и [`frontend`](frontend).

**Можно ли использовать редактор без визуального режима?**

Да, приложение работает как обычный текстовый редактор с Monaco.
