<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multicode Editor</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    #editor { height: 90vh; border: 1px solid #ccc; }
    #controls { padding: 0.5rem; }
  </style>
  <script type="module">
    import { EditorState } from "https://cdn.jsdelivr.net/npm/@codemirror/state@6.4.0/dist/index.js";
    import { EditorView, basicSetup } from "https://cdn.jsdelivr.net/npm/@codemirror/basic-setup@0.20.0/dist/index.js";
    import { javascript } from "https://cdn.jsdelivr.net/npm/@codemirror/lang-javascript@0.19.7/dist/index.js";
    import { python } from "https://cdn.jsdelivr.net/npm/@codemirror/lang-python@0.19.7/dist/index.js";
    import { rust } from "https://cdn.jsdelivr.net/npm/@codemirror/lang-rust@0.20.2/dist/index.js";
    import { html } from "https://cdn.jsdelivr.net/npm/@codemirror/lang-html@0.19.7/dist/index.js";
    import { css } from "https://cdn.jsdelivr.net/npm/@codemirror/lang-css@0.19.7/dist/index.js";
    import { invoke } from "https://cdn.jsdelivr.net/npm/@tauri-apps/api@1.5.0/tauri.js";

    const view = new EditorView({
      state: EditorState.create({
        doc: '',
        extensions: [basicSetup, javascript(), python(), rust(), html(), css()]
      }),
      parent: document.getElementById('editor')
    });

    async function save() {
      await invoke('save_state', { content: view.state.doc.toString() });
    }

    async function load() {
      const content = await invoke('load_state');
      view.dispatch({ changes: { from: 0, to: view.state.doc.length, insert: content } });
    }

    document.getElementById('save').addEventListener('click', save);
    document.getElementById('load').addEventListener('click', load);
  </script>
</head>
<body>
  <div id="editor"></div>
  <div id="controls">
    <button id="save">Save</button>
    <button id="load">Load</button>
  </div>
</body>
</html>
