# Мета-комментарии

Перед началом работы ознакомьтесь с [RULES.md](../RULES.md).

## Структура `VisualMeta`

Каждый блок на холсте описывается структурой `VisualMeta` с полями:

- `version` — версия схемы, по умолчанию 1.
- `id` — уникальный идентификатор блока.
- `x`, `y` — координаты на плоскости.
- `tags` — список произвольных меток.
- `links` — идентификаторы связанных блоков.
- `anchors` — именованные точки внутри блока.
- `tests` — команды для запуска проверок.
- `extends` — родительская запись, от которой наследуются поля.
- `origin` — обратный путь к исходному внешнему файлу.
- `translations` — словарь переводов заголовка блока.
- `ai` — заметка, сгенерированная ИИ.
- `extras` — дополнительные данные плагинов.
- `updated_at` — время последнего обновления.

## Правила вставки `@VISUAL_META`

- Комментарий начинается с маркера `@VISUAL_META` и содержит JSON с данными.
- Формат комментария зависит от языка исходного файла:
  - `//` для языков с C‑подобными однострочными комментариями.
  - `#` для Python и похожих языков.
  - `/* ... */` для блоков CSS и других C‑стилей.
  - `<!-- ... -->` для HTML или XML.
- Функция `upsert` вставляет комментарий в начало файла и обновляет существующую запись с тем же `id`.
- Поле `updated_at` заполняется автоматически при вставке.

## Примеры

### Теги

```rust
// @VISUAL_META {"id":"1","x":1.0,"y":2.0,"tags":["a","b"]}
fn main() {}
```
Из `core/tests/tags.rs` — демонстрирует хранение списка `tags` и чтение его через `read_all`.

### Ссылки

```rust
// @VISUAL_META {"id":"1","x":0.0,"y":0.0,"links":["a","b"]}
fn main() {}
```
Фрагмент из `core/tests/links.rs` показывает использование поля `links` и поиск по ним.

### Дополнительные данные плагина

```text
// @VISUAL_META {"id":"1","x":0,"y":0,"extras":{"outline":"blue"}}
```
Пример из `examples/plugins/README.md`, где в поле `extras` передаётся цвет обводки пользовательского блока.
