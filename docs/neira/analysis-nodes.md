# Узлы анализа (Analysis Nodes)

## Оглавление
- [1. Базовый интерфейс узла](#1-базовый-интерфейс-узла)
- [2. Иерархия и назначение подтипов](#2-иерархия-и-назначение-подтипов)
- [3. Взаимодействие узлов анализа с подсистемами](#3-взаимодействие-узлов-анализа-с-подсистемами)
- [4. Фильтрация и весовка источников](#4-фильтрация-и-весовка-источников)
- [5. Pipeline создания новых подтипов](#5-pipeline-создания-новых-подтипов)
- [6. Приоритеты начального обучения](#6-приоритеты-начального-обучения)
- [7. Автономное расширение](#7-автономное-расширение)
- [8. Управление узлами через редактор](#8-управление-узлами-через-редактор)
- [9. Итоговая документация](#9-итоговая-документация)
- [10. Счётчик ревизий и критерий улучшения](#10-счётчик-ревизий-и-критерий-улучшения)

## 1. Базовый интерфейс узла
- **Интерфейс:** `AnalysisNode`
- **Свойства:** идентификатор, тип, степень достоверности, связи.
- **Методы:** `analyze()`, `explain()`, `updateContext()` и т. п.
- **Назначение:** единый контракт для всех типов узлов, обеспечивающий расширяемость и полиморфизм.

## 2. Иерархия и назначение подтипов

| Подтип | Назначение |
| --- | --- |
| Синтаксические | Разбор структуры языка, токенизация, грамматика. |
| Семантические | Определение смысловых связей, контекста и онтологических отношений. |
| Доменные | Работа с отраслевыми знаниями (медицина, программирование и т. д.). |
| Интеграционные | Сбор и объединение результатов других узлов, построение итоговых планов и ответов. |
| Метакогнитивные | Самоанализ, корректировка ошибок, оптимизация алгоритмов. |
| Целевые (Task/Goal) | Расчленение запросов на задачи, выбор действий для достижения целей. |
| Точные (Deterministic) | Верификация утверждений, проверяемые расчёты, приоритет достоверных данных. |
| Гипотетические | Работа в условиях недостатка данных: уточнения, оценка надежности источников, предупреждения о низкой точности. |
| Эмоционального анализа | Определение эмоционального состояния пользователя и аккуратная реакция на негатив. |
| Обман/Сокрытие (Deception) | Режим, где сообщается частичная или альтернативная информация в ситуациях требования скрытия деталей. |
| Скептические | Проверка достоверности спорных источников, фильтрация псевдонаучных утверждений. |
| Логических ловушек | Распознавание и нейтрализация когнитивных и риторических заблуждений (ошибка большинства, «ошибка выжившего» и др.). |

**Подтипы «Метакогнитивные» дополнительно включают:**
- Ошибка‑анализ: локализация и классификация сбоев.
- Логика опыта: использование заранее заложенных философских и эвристических размышлений.

## 3. Взаимодействие узлов анализа с подсистемами

### Единый оркестратор (InteractionHub)
- Все запросы пользователя проходят через оркестратор.
- AnalysisNode создаёт контекст запроса и обращается к MemoryNode или ActionNode только через InteractionHub, что обеспечивает проверку прав доступа и логирование.
- Ответы узлов агрегируются обратно в оркестратор, который связывает цепочку Analysis⇄Memory⇄Action, вычисляет степень уверенности и формирует итог.

### Планировщик задач (TaskScheduler)
- Каждый запрос классифицируется по сложности и времени: `fast` (до 1 мин), `standard` (до 30 мин), `long` (до 8 часов).
- AnalysisNode оценивает требуемое время и отправляет задачу в соответствующую очередь.
- Для долгих задач система возвращает пользователю идентификатор операции и периодически уведомляет о прогрессе.

#### Пример обработки долгого запроса
1. Пользователь отправляет сложный запрос.
2. InteractionHub регистрирует его и передаёт в очередь `long`.
3. AnalysisNode делит задачу на подэтапы, обращаясь к MemoryNode и вызывая ActionNode.
4. По мере выполнения TaskScheduler сообщает оркестратору о статусе, а тот — пользователю.
5. После завершения результаты агрегируются в InteractionHub и возвращаются пользователю.

## 4. Фильтрация и весовка источников
- **Фильтрация источников:** отдельные списки доверенных книг, статей и сайтов; GitHub‑репозитории только с релизами `v1.0+`.
- **Система весов:** каждому источнику назначается рейтинг надёжности на основе факта публикации, цитируемости и согласованности с уже проверенными знаниями.
- **Квота на «воду»:** фиксируется доля описательных блоков и формализованных правил; узлы отклоняют материал, где структурированных знаний недостаточно.

### Контроль качества и защита от шума
- Согласованность между источниками: новый факт принимается только при подтверждении двумя независимыми источниками.
- Аудит ошибок: при обнаружении несоответствий узел формирует заявку на пересмотр источников.
- Регулярная переоценка: периодические задачи проверяют популярные узлы на предмет устаревания.

## 5. Pipeline создания новых подтипов
1. **Ингестор** извлекает потенциальные знания (правила, алгоритмы, шаблоны).
2. **Дедупликация и сверка:** факты сравниваются с текущей базой; конфликтующие значения помечаются для ручной проверки.
3. **Шаблонизатор** превращает согласованные знания в новое определение узла (`NodeTemplate`).
4. **Человеческое подтверждение:** перед активацией узел проходит review; редактор может уточнить формулировки или отклонить предложение.
5. **Регистрация:** одобренный узел добавляется в фабрику и документируется.

## 6. Приоритеты начального обучения
- **Языки общения:** отдельные узлы для синтаксики и семантики русского и английского языков; их развитие влияет на качество остальных подтипов.
- **Языки программирования:** подтипы для Rust (синтаксис, идиомы, оптимизация) и компонентов стэка Multicode.
- **Доменные ветки:** веб‑, мобильная и десктопная разработка описываются как независимые ветви знаний.
- **Обучение через проекты:** анализируются только релизные ветки репозиториев, фиксируются шаблоны «как делать правильно» и отмечаются анти‑паттерны.

## 7. Автономное расширение
- При обнаружении нового понятия узел инициирует диалог: «Найдено неизвестное правило/техника, добавить новый подтип?».
- После подтверждения запускается pipeline, и создаётся новый `AnalysisNode` с меткой происхождения (source, timestamp, reviewer).
- Фабрика узлов автоматически выбирает или порождает нужный подтип на основании контекста и диалога.
- Метаданные происхождения сохраняются для последующего анализа и обучения.

## 8. Управление узлами через редактор
- Редактор отображает рейтинги источников и историю изменений узла.
- Любой узел может быть помечен как ошибочный; система требует указать причину, ссылку на источник и желаемое действие (исправить, удалить, отложить).
- Диалоговое объяснение каждого узла доступно через метод `explain()`.
- Поддерживается версионирование и возможность удаления узлов.

## 9. Итоговая документация
Предстоит подготовить отдельный документ, описывающий:
- Иерархию узлов и их форматы данных.
- Алгоритмы автономного расширения и согласования.
- API для редактора и взаимодействия с пользователем.
- Примеры новых доменных подтипов и процедур их обучения.

## 10. Счётчик ревизий и критерий улучшения
Каждый узел анализа ведёт счётчик ревизий, фиксируя количество попыток пересмотреть ответ. Новая версия принимается только в случае, если прирост качества превышает установленный порог `IMPROVEMENT_THRESHOLD`.

```pseudo
revision = 0
prevScore = initialScore
while revision < MAX_REVISIONS:
    candidate = generateProposal()
    newScore = evaluate(candidate)
    if newScore - prevScore < IMPROVEMENT_THRESHOLD:
        break
    accept(candidate)
    prevScore = newScore
    revision += 1
```

Пользователь может влиять на пределы через диалоговые команды, например:
- `set revisions 5` — ограничить количество пересмотров.
- `set improvement 0.02` — изменить порог `IMPROVEMENT_THRESHOLD`.

