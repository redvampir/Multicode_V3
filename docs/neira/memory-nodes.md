# Узлы памяти

Узлы памяти хранят агрегированные показатели качества (`QualityMetrics`) и
статистику использования (`UsageStats`). Они служат прослойкой между узлами
анализа и подсистемами ответа, предоставляя базовую выборку знаний.

Каждый узел памяти хранит единицу знания, связанные метрики и журнал ошибок для последующего анализа.

Метрики формируются [узлами анализа](analysis-nodes.md#оценка-качества);
узлы памяти не вычисляют их самостоятельно, а только агрегируют поступившие
значения.

## Хранимые данные и методы

### Структуры

```rust
struct QualityMetrics {
    credibility: f32,    // 0..1
    recency_days: u32,   // возраст данных
    demand: u32,         // число запросов
}

struct UsageStats {
    calls: u64,          // количество обращений
    last_access: u64,    // timestamp последнего обращения
}
```

### Методы

- `update_from_analysis(node_id, QualityMetrics)` — приём метрик от
  Analysis‑узла;
- `get_priority()` — получение текущего приоритета;
- `update_priority()` — пересчёт приоритета с учётом накопленных данных.

## Приоритизация источников

1. **Узлы памяти** — базовая выборка знаний для чернового ответа.
2. **Внутренние базы** — уточнение и расширение при недостатке данных в памяти.
3. **Внешние ресурсы** — привлечение информации из интернета и сторонних источников.

Оценка каждого источника выполняется по трём критериям:

- **Релевантность** — насколько источник соответствует запросу.
- **Доверие** — степень надежности и проверенности данных.
- **Актуальность** — свежесть информации и наличие обновлений.
 
Итоговый приоритет узла вычисляется из показателей достоверности, актуальности
и востребованности, а также накопленной статистики использования.

