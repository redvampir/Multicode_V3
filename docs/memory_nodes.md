# Узлы памяти

Этот документ описывает назначение и устройство узлов памяти, а также принципы работы с ними в системе.

## Документ «Узлы памяти»

### 1. Назначение и общая концепция
Узлы памяти — это единицы сжатого знания, описывающие понятия, факты, правила и т.д. Они служат точками входа к более подробным данным: внутренним базам (книгам, статьям, дипломным работам, расширенным ответам в чатах), внешним интернет‑ресурсам и другим источникам. Система формирует черновой ответ (или код) на основе ближайших узлов, затем при необходимости дополняет его внутренними и внешними данными.

### 2. Стандартная структура узла
Каждый узел содержит обязательные поля:

- **Идентификатор** — уникальный ID узла. Пример: `node_0001`.
- **Тип** — классификация узла (факт, правило, понятие и т.д.). Пример: `fact`.
- **Краткое описание** — суть узла в одной–двух фразах. Пример: `Закон всемирного тяготения Ньютона`.
- **Метаданные** — ключевые слова, дата обновления, уровень доверия. Пример: `keywords: физика; updated: 2024-02-01; trust: high`.
- **Ссылки** — внутренние или внешние источники. Пример: `[Wikipedia](https://ru.wikipedia.org/wiki/Закон_всемирного_тяготения)`.
- **Приоритет** — числовой показатель важности для выборки. Пример: `0.8`.
- **Версия** — номер редакции узла. Пример: `v1.2`.

### 3. Приоритизация источников
Нейроны памяти — начальная выборка для чернового ответа.

Внутренние базы — детальное уточнение/обогащение.

Внешние ресурсы — при недостаточности собственных данных.

Оценка источников опирается на релевантность, доверие и актуальность.

### 4. Триггерная предварительная загрузка
“Узел действий” анализирует ввод пользователя в реальном времени: при обнаружении слов‑триггеров (например, «биология», «программирование», «Rust») система заранее подгружает связанные узлы памяти, экономя время на последующих этапах.

### 5. Оперативная память (кеш) для контекста
Временное хранилище удерживает:

- актуальный контекст запроса,
- промежуточные расчёты и знания.

При смене темы действуют правила сброса/замещения данных (например, LRU). По завершении работы релевантные изменения синхронизируются с постоянными узлами.

### 6. Автоматическая пересборка черновиков
После получения новой информации система пересчитывает черновой ответ или код:

- сохраняет промежуточные версии,
- фиксирует триггеры пересборки,
- ведёт лог изменений для контроля качества.

### 7. Безопасность и контроль доступа
- Фильтрация URL по списку доверенных доменов.
- Разграничение прав доступа к внутренним базам.
- Возможность авторизации и учёта действий, чтобы предотвратить несанкционированные запросы.

## Дополнение и развитие концепции узлов памяти

### Типология узлов и связь с контекстом
Выделите разные типы узлов памяти — факты, правила, понятия, ссылки и т.п. — чтобы при выборке данных учитывать семантику запроса. Это позволит быстрее находить нужную «гранулу знания» и сокращать объём лишнего контента в ответе.
Например, узлы типа «краткий факт» могут иметь более высокий приоритет для предварительной загрузки, а «подробное описание» — для уточнения ответа.

### Инкрементальное обогащение черновика
Рассмотрите процесс пошагового обогащения чернового ответа:

1. Сначала система генерирует короткий набросок, используя ближайшие узлы памяти.
2. Затем добавляет детализацию, подключаясь к внутренним базам знаний.
3. И только в конце, при необходимости, обращается к внешним ресурсам.
Так можно избежать «перебора» данных и оптимизировать время отклика.

### Система “микрорефлексов”
Помимо ключевых слов триггеров (биология, Rust и т.д.), можно добавить «микрорефлексы» — микро-правила, реагирующие на более узкие паттерны (например, «генетические алгоритмы» или «async/await»). Они запускали бы дополнительные модули поиска, если детектируется субтема.

### Комбинация топ-Down и bottom-Up
В дополнение к централизованному алгоритму поиска полезно внедрить bottom-up подход: узлы, связанные с уже найденными, могут «выступать с инициативой» и предлагать себя для дальнейшей выборки. Это позволяет системе выходить на неожиданные, но релевантные детали.

### Контроль объёма и “теснота”
Важно контролировать, сколько узлов одновременно загружаются в оперативную память. Использование «тесноты» или «охвата» — показатели, сколько узлов относят себя к одной теме и насколько они взаимосвязаны. Если система видит, что охват стал слишком широким, можно автоматически ограничить количество узлов, чтобы не потерять фокус.

### Интерактивная адаптация
Во время обсуждения с пользователем система может отслеживать, какие детали вызывают уточнения или дополнительные вопросы. Эти сигналы могут менять приоритеты: например, если пользователь не удовлетворён поверхностным ответом, система усиливает запрос более подробных и авторитетных источников.

### Лог виртуальных цитат
Чтобы пользователю было понятно, откуда берётся информация, полезно вести лог «виртуальных цитат» — меток, указующих, какие узлы памяти или базы были задействованы. Это повышает прозрачность и помогает выбирать, какие части информации сохранять, обновлять или удалять.

Такой подход позволяет гибко управлять информацией, подгружать лишь необходимое и поддерживать баланс между скоростью, точностью и масштабируемостью.
